trainer:
  class_path: eva.Trainer
  init_args:
    accelerator: cpu
    n_runs: &N_RUNS ${oc.env:N_RUNS, 2}
    default_root_dir: &LIGHTNING_ROOT ${oc.env:LIGHTNING_ROOT, logs/test/multimodal/online/patch_camelyon}
    max_epochs: &MAX_EPOCHS 1
    limit_val_batches: 2
    limit_test_batches: 2
    precision: bf16
    checkpoint_type: null
    callbacks:
      - class_path: eva.callbacks.ConfigurationLogger
model:
  class_path: eva.multimodal.models.modules.VisionLanguageModule
  init_args:
    model:
      class_path: eva.multimodal.models.wrappers.ModelFromRegistry
      init_args:
        model_name: ${oc.env:MODEL_NAME, anthropic/claude-3-7-sonnet-20250219}
        model_extra_kwargs: ${oc.env:MODEL_EXTRA_KWARGS, null}
    metrics:
      common:
        - class_path: eva.metrics.MulticlassClassificationMetrics
          init_args:
            num_classes: 2
            input_type: "discrete"
    postprocess:
      predictions_transforms:
        - class_path: eva.language.utils.str_to_int_tensor.CastStrToIntTensor
          init_args:
            mapping: {"A": 0, "B": 1}
            case_sensitive: false
data:
  class_path: eva.DataModule
  init_args:
    datasets:
      val:
        class_path: eva.multimodal.data.datasets.PatchCamelyon
        init_args: &DATASET_ARGS
          root: ${oc.env:TESTS_ROOT, tests/eva}/assets/vision/datasets/patch_camelyon
          split: val
          download: false
          transforms:
            image:
              class_path: eva.vision.data.transforms.Resize
              init_args:
                size: ${oc.env:RESIZE_DIM, null}
                max_bytes: ${oc.env:IMAGE_MAX_BYTES, null}
          max_samples: null
      test:
        class_path: eva.multimodal.data.datasets.PatchCamelyon
        init_args:
          <<: *DATASET_ARGS
          split: test
    dataloaders:
      val: &DATALOADER_ARGS
        batch_size: &BATCH_SIZE ${oc.env:BATCH_SIZE, 16}
        collate_fn: eva.multimodal.data.dataloaders.text_image_collate
        num_workers: 0
        pin_memory: false
        persistent_workers: false
        prefetch_factor: null
      test:
        <<: *DATALOADER_ARGS
